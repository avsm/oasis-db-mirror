OASISFormat: 0.2
Name:        oasis-db
Version:     0.1.0~alpha2
Authors:     Sylvain Le Gall
Copyrights:  (C) 2010 OCamlCore SARL 
Homepage:    http://oasis.forge.ocamlcore.org/
Plugins:     DevFiles (0.2), StdFiles (0.2), META (0.2)
License:     LGPL-2.1 with OCaml linking exception
LicenseFile: COPYING.txt
FilesAB:     src/lib/ODBConf.ml.ab
BuildTools:  ocamlbuild, make

Synopsis: Database and web interface of OASIS packages

Description:
  OASIS-DB is a database of OCaml packages using OASIS.

Flag dev
  Description: Create a dev mode webserver
  Default: true

Flag gettext
  Description: Use ocaml-gettext for i18n
  Default: false

if flag(gettext) 
  PostBuildCommand: $make -C po all
  PostCleanCommand: $make -C po clean
  PostInstallCommand:   $make -C po install PODIR=$prefix/share/locale
  PostUninstallCommand: $make -C po install PODIR=$prefix/share/locale

Library "oasis-db"
  Path: src/lib
  CompiledObject: Best
  Modules: ODBUtils,
           ODBConf,
           ODBGettext,
           ODBContext,
           ODBMessage,
           ODBTypes,
           ODBFileUtil,
           ODBProcess,
           ODBArchive,
           ODBPkg,
           ODBVer,
           ODBStorage,
           ODBInotify,
           ODBCompletion,
           ODBIncoming,
           ODBMain,
           ODBRunner,
           ODBOASIS,
           LwtExt
  BuildDepends: lwt, lwt.unix,
                unix, 
                pcre,
                oasis, oasis.builtin-plugins,
                sexplib,
                calendar,
                inotify,
                fileutils
  
Flag oasis_db_ocsigen
  Description: Build ocsigen module for OASIS-DB. It requires postgresql running.
  Default: false

Library "oasis-db-ocsigen"
  FindlibParent: oasis-db
  FindlibName: ocsigen
  Path: src/web
  CompiledObject: Best
  Build$: flag(oasis_db_ocsigen)
  Modules: Index,
           AccountStub,
           Account,
           Template,
           MyAccount,
           NewAccount,
           Browse,
           SQL,
           Log,
           Dist,
           Upload,
           Mkd,
           Context,
           Defer,
           Init
  BuildDepends: oasis-db, 
                ocsigen, 
                pgocaml, 
                netstring, 
                threads, 
                calendar,
                markdown, markdown.html

Executable "oasis-server"
  Path: src/web
  CompiledObject: Native
  Build$: flag(oasis_db_ocsigen)
  MainIs: Main.ml
  BuildDepends: oasis-db.ocsigen, 
                threads, 
                ocsigen.ext.staticmod,
                ocsigen.ext.ocsipersist-sqlite,
                ocsigen.ext.eliom,
                ocsigen.ext.staticmod,
                ocsigen.server,
                ocsigen.commandline

  
Executable FakeIncoming
  Path: test
  MainIs: FakeIncoming.ml
  BuildDepends: oasis-db

Executable test
  Path:   test
  MainIs: test.ml
  BuildDepends: oUnit, fileutils, oasis-db
  
Test main
  Command: $test
  TestTools: test, FakeIncoming
  
Executable inrestart 
  Path:         src/tools/inrestart
  MainIs:       Main.ml
  BuildDepends: inotify, unix, fileutils
